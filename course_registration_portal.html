<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amity University - Flexible Timetable Registration</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Visualization & Content Choices:
    - Course Catalog: Goal: Inform & Allow Selection. Viz/Presentation Method: List of course cards with dropdowns for slot selection. Interaction: Department sidebar navigation (click), dropdown selection (change event), register/deregister buttons (click). Justification: Provides a clear, scannable list of courses with all necessary details and enables flexible slot choice. Library/Method: HTML, Tailwind CSS, Vanilla JS.
    - Live Timetable: Goal: Visualize schedule, detect conflicts, show availability. Viz/Presentation Method: HTML table grid representing days and time blocks. Interaction: Cells dynamically update color and content based on user selections (highlighted), confirmed registrations (registered), or conflicts/unavailability (frozen/conflict). Justification: Directly addresses the need for a digital, interactive timetable for real-time feedback and error reduction. Library/Method: HTML table, Tailwind CSS, Vanilla JS.
    - Credit Counter: Goal: Inform about credit load. Viz/Presentation Method: Simple text display. Interaction: Updates dynamically as courses are added/removed. Justification: Helps students stay within credit limits. Library/Method: HTML span, Vanilla JS.
    - Message Box: Goal: Provide user feedback (success, error, warning). Viz/Presentation Method: Modal overlay. Interaction: Click "OK" to dismiss. Justification: Replaces disruptive alert() and provides a consistent, styled feedback mechanism. Library/Method: HTML divs, Tailwind CSS, Vanilla JS.
    - CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        :root {
            --navy-blue: #000080;
            --amity-yellow: #FFC000;
            --light-gray: #f4f7f6;
            --dark-text: #2c3e50;
            --medium-text: #555;
            --white: #ffffff;
            --success-green: #28a745;
            --error-red: #dc3545;
        }
        @keyframes gradient-xy {
            0%, 100% { background-position: 0% 0%; }
            50% { background-position: 100% 100%; }
        }
        .animate-gradient-xy {
            animation: gradient-xy 15s ease infinite;
            background-size: 400% 400%;
        }
        body {
            font-family: 'Open Sans', sans-serif;
            color: var(--medium-text);
            background-color: var(--light-gray);
        }
        .sidebar {
            width: 16rem;
            background-color: #1e3a8a;
            color: #fff;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            position: fixed;
            height: 100%;
            overflow-y: auto;
        }
        .sidebar h2 {
            font-size: 1.5rem;
            font-weight: 800;
            margin-bottom: 1.5rem;
            color: #FFC000;
            border-bottom: 2px solid #FFC000;
            padding-bottom: 0.75rem;
            font-family: 'Montserrat', sans-serif;
        }
        .sidebar-item {
            padding: 0.75rem 1rem;
            margin-bottom: 0.75rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            font-weight: 600;
            font-size: 1.125rem;
            background-color: var(--navy-blue);
        }
        .sidebar-item:hover {
            background-color: #1d4ed8;
            transform: scale(1.05);
        }
        .sidebar-item.active {
            background-color: #FFC000;
            color: #000080;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(0,0,0,0.10);
            transform: scale(1.05);
        }
        .main-content {
            margin-left: 16rem;
            padding: 2rem;
        }
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                box-shadow: none;
            }
            .main-content {
                margin-left: 0;
            }
        }
        .header {
            background: #fff;
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            margin-bottom: 2rem;
            text-align: center;
        }
        .header h1 {
            font-size: 2.25rem;
            font-weight: 800;
            color: #1e3a8a;
            margin-bottom: 0.5rem;
            font-family: 'Montserrat', sans-serif;
        }
        .header h2 {
            font-size: 1.5rem;
            font-weight: 600;
            color: #374151;
            font-family: 'Montserrat', sans-serif;
        }
        .content-section {
            background: #fff;
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            margin-bottom: 2rem;
        }
        .content-section h2 {
            font-size: 1.875rem;
            font-weight: 800;
            color: #1e3a8a;
            border-bottom: 4px solid #FFC000;
            padding-bottom: 0.75rem;
            margin-bottom: 1.5rem;
            font-family: 'Montserrat', sans-serif;
        }
        #select-dept-message h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #4b5563;
            text-align: center;
            padding: 2.5rem 0;
        }
        #available-courses-list, #registered-courses-list {
            display: grid;
            grid-template-columns: repeat(1, minmax(0, 1fr));
            gap: 1.5rem;
        }
        @media (min-width: 768px) {
            #available-courses-list, #registered-courses-list {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
        }
        @media (min-width: 1024px) {
            #available-courses-list, #registered-courses-list {
                grid-template-columns: repeat(3, minmax(0, 1fr));
            }
        }
        .course-box, .registered-course-item {
            background: #f9fafb;
            padding: 1.25rem;
            border-radius: 0.5rem;
            box-shadow: 0 1px 4px rgba(0,0,0,0.04);
            border: 1px solid #e5e7eb;
            transition: all 0.2s ease-in-out;
        }
        .course-box:hover, .registered-course-item:hover {
            box-shadow: 0 4px 12px rgba(30,64,175,0.10);
            border-color: #60a5fa;
        }
        .course-box h3, .registered-course-item h3 {
            font-size: 1.25rem;
            font-weight: bold;
            color: #1e40af;
            margin-bottom: 0.5rem;
            font-family: 'Montserrat', sans-serif;
        }
        .course-box p, .registered-course-item p {
            color: #4b5563;
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }
        .course-box h4 {
            font-size: 1rem;
            font-weight: 600;
            color: #374151;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
        }
        .slot-select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            background: #fff;
            color: #1f2937;
            font-size: 0.875rem;
            outline: none;
        }
        .slot-select:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px #3b82f6;
        }
        .register-btn, .deregister-btn {
            width: 100%;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: bold;
            margin-top: 1rem;
            transition: all 0.2s;
            transform: translateY(0);
            box-shadow: 0 1px 4px rgba(0,0,0,0.04);
        }
        .register-btn {
            background: #FFC000;
            color: #000080;
        }
        .register-btn:hover {
            background: #e6ac00;
        }
        .register-btn:disabled {
            background: #d1d5db;
            color: #6b7280;
            cursor: not-allowed;
        }
        .deregister-btn {
            background: #ef4444;
            color: #fff;
        }
        .deregister-btn:hover {
            background: #dc2626;
        }
        #no-registered-message {
            color: #4b5563;
            text-align: center;
            padding: 1.25rem 0;
            grid-column: 1 / -1;
        }
        .timetable-container {
            overflow-x: auto;
        }
        .timetable {
            width: 100%;
            border-collapse: collapse;
            table-layout: auto;
            min-width: max-content;
        }
        .timetable th, .timetable td {
            border: 1px solid #d1d5db;
            padding: 0.5rem;
            text-align: center;
            vertical-align: middle;
            font-size: 0.875rem;
        }
        .timetable thead th {
            background: #1e40af;
            color: #fff;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .timetable .time-slot-header {
            background: #1d4ed8;
            color: #fff;
            font-weight: 600;
        }
        .timetable .slot-type-header {
            background: #2563eb;
            color: #fff;
            font-weight: 500;
        }
        .timetable .day-header {
            background: #3b82f6;
            color: #fff;
            font-weight: bold;
            text-transform: uppercase;
        }
        .timetable .lunch-slot {
            background: #d1d5db;
            color: #374151;
            font-weight: 600;
            font-style: italic;
        }
        .timetable .time-slot {
            background: #fff;
        }
        /* Transparency applied here */
        .timetable .highlighted {
            background: rgba(254, 243, 199, 0.7); /* Lighter yellow with transparency */
            border-color: #f59e42;
        }
        .timetable .registered {
            background: rgba(187, 247, 208, 0.7); /* Lighter green with transparency */
            border-color: #22c55e;
            font-weight: 600;
            color: #166534;
        }
        .timetable .frozen {
            background: rgba(229, 231, 235, 0.7); /* Lighter gray with transparency */
            color: #6b7280;
            font-style: italic;
            cursor: not-allowed;
        }
        .timetable .conflict {
            background: #fecaca; /* Red remains opaque for strong warning */
            border-color: #ef4444;
            color: #b91c1c;
        }
        .timetable .cell-content {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
        }
        .timetable .cell-content span {
            display: block;
            font-size: 0.75rem;
            line-height: 1.1;
        }
        .timetable .cell-content span:first-child {
            font-weight: bold;
        }
        #messageBox {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            display: none;
        }
        #messageBox .message-content {
            background: #fff;
            padding: 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 16px rgba(0,0,0,0.12);
            max-width: 24rem;
            width: 100%;
            text-align: center;
        }
        #messageBox h3 {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 1rem;
            font-family: 'Montserrat', sans-serif;
        }
        #messageBox p {
            margin-bottom: 1.5rem;
            color: #374151;
        }
        #messageBox button {
            background: #000080;
            color: #fff;
            padding: 0.5rem 1.25rem;
            border: none;
            border-radius: 0.375rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }
        #messageBox button:hover {
            background: #1d4ed8;
        }
    </style>
</head>
<body class="flex min-h-screen">
    <aside class="sidebar">
        <h2>Departments</h2>
        <div class="sidebar-item active" data-dept="cse">Computer Science</div>
        <div class="sidebar-item" data-dept="aiml">AI & Machine Learning</div>
        <div class="sidebar-item" data-dept="ece">Electronics & Comm. Eng.</div>
        <div class="sidebar-item" data-dept="math">Mathematics</div>
        <div class="sidebar-item" data-dept="chem">Chemistry</div>
        <div class="sidebar-item" data-dept="phy">Physics</div>
        <div class="sidebar-item" data-dept="lang">Languages</div>
        <div class="sidebar-item" data-dept="nutrition">Nutrition</div>
        <div class="sidebar-item" data-dept="psyc">Psychology</div>
    </aside>
    <main class="main-content flex-grow">
        <header class="header">
            <h1>Course Registration Portal</h1>
            <h2>Available Courses for: <span id="selected-dept-title">Computer Science</span></h2>
            <p class="text-lg font-semibold text-gray-700 mt-4">Total Credits: <span id="total-credits">0</span> / 27</p>
        </header>
        <section class="content-section">
            <h2>Available Courses</h2>
            <p class="text-gray-600 mb-4">Browse courses by department and select your preferred slots. The timetable below will update dynamically to show your selections and any potential conflicts.</p>
            <div id="select-dept-message" class="hidden">
                <h3>Please select a department from the sidebar to view available courses.</h3>
            </div>
            <div id="available-courses-list"></div>
        </section>
        <section class="content-section">
            <h2>Your Registered Courses</h2>
            <p class="text-gray-600 mb-4">Here are the courses you have successfully registered for. You can remove them if needed.</p>
            <div id="registered-courses-list">
                <p id="no-registered-message">You have not registered for any courses yet.</p>
            </div>
        </section>
        <section class="content-section">
            <h2>Live Timetable</h2>
            <p class="text-gray-600 mb-4">This interactive timetable visualizes your selected courses. Green cells are registered, yellow are highlighted selections, grey are frozen (unavailable due to conflicts), and red indicates a direct conflict.</p>
            <div class="timetable-container">
                <table class="timetable" id="live-timetable">
                    <thead>
                        <tr>
                            <th rowspan="2" colspan="2">Day</th>
                            <th colspan="2" class="time-slot-header">9:00-10:45 AM</th>
                            <th colspan="2" class="time-slot-header">10:50 AM-12:35 PM</th>
                            <th rowspan="2">12:35-1:15 PM<br>(LUNCH)</th>
                            <th colspan="2" class="time-slot-header">1:15 PM-3:00 PM</th>
                            <th colspan="2" class="time-slot-header">3:05 PM-4:50 PM</th>
                        </tr>
                        <tr>
                            <th class="slot-type-header">9:00-9:50</th>
                            <th class="slot-type-header">9:55-10:45</th>
                            <th class="slot-type-header">10:50-11:40</th>
                            <th class="slot-type-header">11:45-12:35</th>
                            <th class="slot-type-header">1:15-2:05</th>
                            <th class="slot-type-header">2:10-3:00</th>
                            <th class="slot-type-header">3:05-3:55</th>
                            <th class="slot-type-header">4:00-4:50</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td rowspan="2" class="day-header">MON</td>
                            <td class="slot-type-header">Theory</td>
                            <td id="mon-T1A" class="time-slot" data-day="MON" data-time-block="T1A"></td> <td id="mon-T1B" class="time-slot" data-day="MON" data-time-block="T1B"></td> <td id="mon-T2A" class="time-slot" data-day="MON" data-time-block="T2A"></td> <td id="mon-T2B" class="time-slot" data-day="MON" data-time-block="T2B"></td> <td rowspan="2" class="lunch-slot"></td>
                            <td id="mon-T3A" class="time-slot" data-day="MON" data-time-block="T3A"></td> <td id="mon-T3B" class="time-slot" data-day="MON" data-time-block="T3B"></td> <td id="mon-T4A" class="time-slot" data-day="MON" data-time-block="T4A"></td> <td id="mon-T4B" class="time-slot" data-day="MON" data-time-block="T4B"></td> </tr>
                        <tr>
                            <td class="slot-type-header">Lab</td>
                            <td colspan="2" id="mon-L1" class="time-slot" data-day="MON" data-time-block="L1"></td> <td colspan="2" id="mon-L2" class="time-slot" data-day="MON" data-time-block="L2"></td> <td colspan="2" id="mon-L3" class="time-slot" data-day="MON" data-time-block="L3"></td> <td colspan="2" id="mon-L4" class="time-slot" data-day="MON" data-time-block="L4"></td> </tr>
                        <tr>
                            <td rowspan="2" class="day-header">TUE</td>
                            <td class="slot-type-header">Theory</td>
                            <td id="tue-T1A" class="time-slot" data-day="TUE" data-time-block="T1A"></td>
                            <td id="tue-T1B" class="time-slot" data-day="TUE" data-time-block="T1B"></td>
                            <td id="tue-T2A" class="time-slot" data-day="TUE" data-time-block="T2A"></td>
                            <td id="tue-T2B" class="time-slot" data-day="TUE" data-time-block="T2B"></td>
                            <td rowspan="2" class="lunch-slot"></td>
                            <td id="tue-T3A" class="time-slot" data-day="TUE" data-time-block="T3A"></td>
                            <td id="tue-T3B" class="time-slot" data-day="TUE" data-time-block="T3B"></td>
                            <td id="tue-T4A" class="time-slot" data-day="TUE" data-time-block="T4A"></td>
                            <td id="tue-T4B" class="time-slot" data-day="TUE" data-time-block="T4B"></td>
                        </tr>
                        <tr>
                            <td class="slot-type-header">Lab</td>
                            <td colspan="2" id="tue-L1" class="time-slot" data-day="TUE" data-time-block="L1"></td>
                            <td colspan="2" id="tue-L2" class="time-slot" data-day="TUE" data-time-block="L2"></td>
                            <td colspan="2" id="tue-L3" class="time-slot" data-day="TUE" data-time-block="L3"></td>
                            <td colspan="2" id="tue-L4" class="time-slot" data-day="TUE" data-time-block="L4"></td>
                        </tr>
                        <tr>
                            <td rowspan="2" class="day-header">WED</td>
                            <td class="slot-type-header">Theory</td>
                            <td id="wed-T1A" class="time-slot" data-day="WED" data-time-block="T1A"></td>
                            <td id="wed-T1B" class="time-slot" data-day="WED" data-time-block="T1B"></td>
                            <td id="wed-T2A" class="time-slot" data-day="WED" data-time-block="T2A"></td>
                            <td id="wed-T2B" class="time-slot" data-day="WED" data-time-block="T2B"></td>
                            <td rowspan="2" class="lunch-slot"></td>
                            <td id="wed-T3A" class="time-slot" data-day="WED" data-time-block="T3A"></td>
                            <td id="wed-T3B" class="time-slot" data-day="WED" data-time-block="T3B"></td>
                            <td id="wed-T4A" class="time-slot" data-day="WED" data-time-block="T4A"></td>
                            <td id="wed-T4B" class="time-slot" data-day="WED" data-time-block="T4B"></td>
                        </tr>
                        <tr>
                            <td class="slot-type-header">Lab</td>
                            <td colspan="2" id="wed-L1" class="time-slot" data-day="WED" data-time-block="L1"></td>
                            <td colspan="2" id="wed-L2" class="time-slot" data-day="WED" data-time-block="L2"></td>
                            <td colspan="2" id="wed-L3" class="time-slot" data-day="WED" data-time-block="L3"></td>
                            <td colspan="2" id="wed-L4" class="time-slot" data-day="WED" data-time-block="L4"></td>
                        </tr>
                        <tr>
                            <td rowspan="2" class="day-header">THU</td>
                            <td class="slot-type-header">Theory</td>
                            <td id="thu-T1A" class="time-slot" data-day="THU" data-time-block="T1A"></td>
                            <td id="thu-T1B" class="time-slot" data-day="THU" data-time-block="T1B"></td>
                            <td id="thu-T2A" class="time-slot" data-day="THU" data-time-block="T2A"></td>
                            <td id="thu-T2B" class="time-slot" data-day="THU" data-time-block="T2B"></td>
                            <td rowspan="2" class="lunch-slot"></td>
                            <td id="thu-T3A" class="time-slot" data-day="THU" data-time-block="T3A"></td>
                            <td id="thu-T3B" class="time-slot" data-day="THU" data-time-block="T3B"></td>
                            <td id="thu-T4A" class="time-slot" data-day="THU" data-time-block="T4A"></td>
                            <td id="thu-T4B" class="time-slot" data-day="THU" data-time-block="T4B"></td>
                        </tr>
                        <tr>
                            <td class="slot-type-header">Lab</td>
                            <td colspan="2" id="thu-L1" class="time-slot" data-day="THU" data-time-block="L1"></td>
                            <td colspan="2" id="thu-L2" class="time-slot" data-day="THU" data-time-block="L2"></td>
                            <td colspan="2" id="thu-L3" class="time-slot" data-day="THU" data-time-block="L3"></td>
                            <td colspan="2" id="thu-L4" class="time-slot" data-day="THU" data-time-block="L4"></td>
                        </tr>
                        <tr>
                            <td rowspan="2" class="day-header">FRI</td>
                            <td class="slot-type-header">Theory</td>
                            <td id="fri-T1A" class="time-slot" data-day="FRI" data-time-block="T1A"></td>
                            <td id="fri-T1B" class="time-slot" data-day="FRI" data-time-block="T1B"></td>
                            <td id="fri-T2A" class="time-slot" data-day="FRI" data-time-block="T2A"></td>
                            <td id="fri-T2B" class="time-slot" data-day="FRI" data-time-block="T2B"></td>
                            <td rowspan="2" class="lunch-slot"></td>
                            <td id="fri-T3A" class="time-slot" data-day="FRI" data-time-block="T3A"></td>
                            <td id="fri-T3B" class="time-slot" data-day="FRI" data-time-block="T3B"></td>
                            <td id="fri-T4A" class="time-slot" data-day="FRI" data-time-block="T4A"></td>
                            <td id="fri-T4B" class="time-slot" data-day="FRI" data-time-block="T4B"></td>
                        </tr>
                        <tr>
                            <td class="slot-type-header">Lab</td>
                            <td colspan="2" id="fri-L1" class="time-slot" data-day="FRI" data-time-block="L1"></td>
                            <td colspan="2" id="fri-L2" class="time-slot" data-day="FRI" data-time-block="L2"></td>
                            <td colspan="2" id="fri-L3" class="time-slot" data-day="FRI" data-time-block="L3"></td>
                            <td colspan="2" id="fri-L4" class="time-slot" data-day="FRI" data-time-block="L4"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </main>
    <div id="messageBox" class="hidden">
        <div class="message-content">
            <h3 id="messageTitle"></h3>
            <p id="messageText"></p>
            <button onclick="hideMessageBox()">OK</button>
        </div>
    </div>
    <script>
        const departmentCourses = {
            cse: [
                {
                    code: "CSE1017",
                    name: "Programming in C and C++",
                    credits: 4,
                    options: [
                        { slot: "D1", room: "211", faculty: "Dr. Punam Kumari", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "D1", room: "210", faculty: "Dr. Senthil Kumar Janagan", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "D1", room: "312", faculty: "Dr. Rajat", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "D2", room: "211", faculty: "Dr. Punam Kumari", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "D2", room: "210", faculty: "Dr. Senthil Kumar Janagan", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "D2", room: "312", faculty: "Dr. Rajat", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "E1", room: "620", faculty: "Dr. Senthil Kumar Janagan", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "G1", room: "206", faculty: "Dr. Rajesh Kumar", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "G1", room: "209", faculty: "Dr. Kumar Shashvat", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "G1", room: "208", faculty: "Mr. Mohan", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        // Lab slots - now 1 credit each, and always pairs. Mapped to L1, L2, L3, L4 time blocks.
                        { slot: "L1+L2", room: "507, 508", faculty: "Dr. Punam Kumari", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L3+L4", room: "509", faculty: "Mr. Mohan", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L5+L6", room: "507, 508", faculty: "Dr. Senthil Kumar Janagan", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L7+L8", room: "507, 508", faculty: "Dr. Punam Kumari", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L9+L10", room: "509, 507", faculty: "Dr. Kumar Shashvat", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L11+L12", room: "507, 509", faculty: "Dr. Senthil Kumar Janagan", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L13+L14", room: "509, 508", faculty: "Mr.Mohan", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L15+L16", room: "507, 508", faculty: "Dr. Rajesh Kumar", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L17+L18", room: "508, 507", faculty: "Dr. Punam Kumari", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L19+L20", room: "509", faculty: "Dr. Senthil Kumar Janagan", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L21+L22", room: "507, 508", faculty: "Dr. Punam Kumari", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L23+L24", room: "509", faculty: "Mr. Mohan", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L25+L26", room: "507, 508", faculty: "Dr. Senthil Kumar Janagan", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L27+L28", room: "507, 508", faculty: "Dr. Punam Kumari", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L29+L30", room: "509, 507", faculty: "Dr. Kumar Shashvat", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L31+L32", room: "507, 509", faculty: "Dr. Senthil Kumar Janagan", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L33+L34", room: "509, 508", faculty: "Mr.Mohan", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L35+L36", room: "507, 508", faculty: "Dr. Rajesh Kumar", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L37+L38", room: "508, 507", faculty: "Dr. Punam Kumari", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L39+L40", room: "509", faculty: "Dr. Senthil Kumar Janagan", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },

                        // Complex composite slots - these are combinations of the above pairs
                        // Example: L1+L2 (MON-L1) & L11+L12 (WED-L2)
                        { slot: "L1+L2 & L11+L12", room: "507, 508, 509", faculty: "Dr. Punam Kumari, Mr. Mohan", capacity: 120, currentEnrollment: 0, type: "Lab", credits: 2 },
                        // Example: L11+L12 (WED-L2) & L19+L20 (FRI-L2)
                        { slot: "L11+L12 & L19+L20", room: "507, 508", faculty: "Dr. Senthil Kumar Janagan, Dr.Deepak Raj", capacity: 120, currentEnrollment: 0, type: "Lab", credits: 2 },
                        // Example: L31+L32 (WED-L4) & L21+L22 (MON-L3)
                        { slot: "L31+L32 & L21+L22", room: "507, 508", faculty: "Dr. Punam Kumari, Dr. Senthil Kumar Janagan", capacity: 120, currentEnrollment: 0, type: "Lab", credits: 2 },
                        // Example: L35+L36 (THU-L4) & L25+L26 (TUE-L3)
                        { slot: "L35+L36 & L25+L26", room: "509, 507", faculty: "Dr. Kumar Shashvat, Dr Arshpreet Kaur", capacity: 120, currentEnrollment: 0, type: "Lab", credits: 2 },
                        // Example: L21+L22 (MON-L3) & L37+L38 (FRI-L3)
                        { slot: "L21+L22 & L37+L38", room: "507, 509", faculty: "Dr. Senthil Kumar Janagan, Dr. Senthil Kumar Janagan", capacity: 120, currentEnrollment: 0, type: "Lab", credits: 2 },
                        // Example: L21+L22 (MON-L3) & L39+L40 (FRI-L4)
                        { slot: "L21+L22 & L39+L40", room: "509, 508", faculty: "Mr.Mohan, Mr.Mohan", capacity: 120, currentEnrollment: 0, type: "Lab", credits: 2 },
                        // Example: L27+L28 (TUE-L4) & L37+L38 (FRI-L3)
                        { slot: "L27+L28 & L37+L38", room: "507, 508", faculty: "Dr. Rajesh Kumar, Dr. Senthil Kumar Janagan", capacity: 120, currentEnrollment: 0, type: "Lab", credits: 2 },
                        // Example: L27+L28 & L39+L40 (TUE-L4 & FRI-L4)
                        { slot: "L27+L28 & L39+L40", room: "508, 507", faculty: "Dr. Punam Kumari, Mr.Mohan", capacity: 120, currentEnrollment: 0, type: "Lab", credits: 2 },
                    ]
                },
                {
                    code: "CSE2015",
                    name: "Source Code Management",
                    credits: 1,
                    options: [
                        { slot: "L13+L14", room: "508", faculty: "Dr. Vinob Chander R", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L15+L16", room: "509", faculty: "Dr. Monit Kapoor", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L15+L16", room: "508", faculty: "Dr. Rajat", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L29+L30", room: "507", faculty: "Dr. Rajat", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L3+L4", room: "507", faculty: "Dr. Rajat", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L3+L4", room: "508", faculty: "Dr. Vinob Chander R", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L5+L6", room: "509", faculty: "Dr. Vinob Chander R", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L5+L6", room: "507", faculty: "Dr. Monit Kapoor", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L5+L6", room: "508", faculty: "Dr. Rajat", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L7+L8", room: "507", faculty: "Dr. Rajat", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                    ]
                },
                {
                    code: "CSE2002",
                    name: "Web Technology",
                    credits: 4,
                    options: [
                        { slot: "D1", room: "620", faculty: "Dr Arshpreet Kaur", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "D1", room: "614", faculty: "Dr.Deepak Raj", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "E1", room: "209", faculty: "Dr Arshpreet Kaur", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "E1", room: "312", faculty: "Dr.Deepak Raj", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "E2", room: "207", faculty: "Dr Arshpreet Kaur", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "E2", room: "312", faculty: "Dr.Deepak Raj", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "F2", room: "206", faculty: "Dr Arshpreet Kaur", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "F2", room: "312", faculty: "Dr.Deepak Raj", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "G1", room: "312", faculty: "Dr.Deepak Raj", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "G1", room: "614", faculty: "Dr. Madhu Bhan", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        // Lab Slots - now 1 credit each
                        { slot: "L23+L24", room: "508", faculty: "Dr Arshpreet Kaur", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L25+L26", room: "509", faculty: "Dr.Deepak Raj", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L9+L10", room: "507", faculty: "Dr. Madhu Bhan", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L15+L16", room: "508", faculty: "Dr Arshpreet Kaur", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L29+L30", room: "509", faculty: "Dr.Deepak Raj", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L33+L34", room: "507", faculty: "Dr Arshpreet Kaur", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L19+L20", room: "509", faculty: "Dr.Deepak Raj", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                    ]
                }
            ],
            aiml: [
                {
                    code: "AIML2001",
                    name: "Machine Learning Basics",
                    credits: 4,
                    options: [
                        { slot: "A1", room: "301", faculty: "Dr. Alice", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "B2", room: "302", faculty: "Dr. Bob", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "L21+L22", room: "501", faculty: "Dr. Alice", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 }
                    ]
                }
            ],
            ece: [
                {
                    code: "ECE1001",
                    name: "Fundamentals of Electrical and Electronics Engineering",
                    credits: 4,
                    options: [
                        { slot: "B1", room: "312", faculty: "Mrs. Bugide Sreevidya", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "B1", room: "210", faculty: "Mrs. Anughna N", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "C2", room: "210", faculty: "Mrs. Bugide Sreevidya", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "C2", room: "211", faculty: "Mrs. Anughna N", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        // Lab slots - now 1 credit each
                        { slot: "L1+L2", room: "006", faculty: "Mrs. Anughna N", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L21+L22", room: "006", faculty: "Mrs. Bugide Sreevidya", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L25+L26", room: "006", faculty: "Mrs. Anughna N", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L3+L4", room: "006", faculty: "Mrs. Bugide Sreevidya", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L31+L32", room: "006", faculty: "Mrs. Bugide Sreevidya", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L33+L34", room: "006", faculty: "Mrs. Anughna N", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L39+L40", room: "006", faculty: "Mrs. Bugide Sreevidya", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L7+L8", room: "006", faculty: "Mrs. Anughna N", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                    ]
                }
            ],
            math: [
                {
                    code: "MAT1002",
                    name: "Differential Equations and Transform Techniques",
                    credits: 4,
                    options: [
                        { slot: "A1", room: "206", faculty: "Dr. P. SENTHIL KUMAR", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "A1", room: "207", faculty: "Ms. SWETHA", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "A1", room: "208", faculty: "Mr. ANKIT KUMAR YADAV", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "B2", room: "210", faculty: "Dr. P. SENTHIL KUMAR", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "B2", room: "206", faculty: "Ms. THUNGA S", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "B2", room: "207", faculty: "Ms. SWETHA", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "B2", room: "208", faculty: "Dr. RAVLJ", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "B2", room: "209", faculty: "Mr. ANKIT KUMAR YADAV", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "C1", room: "206", faculty: "Dr. RAVLJ", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "C1", room: "207", faculty: "Mr. ANKIT KUMAR YADAV", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "C2", room: "206", faculty: "Ms. THUNGA S", capacity: 60, currentEnrollment: 0, type: "Theory" },
                    ]
                }
            ],
            chem: [
                {
                    code: "CHE1001",
                    name: "Environmental Studies",
                    credits: 4,
                    options: [
                        { slot: "D1", room: "206", faculty: "Smt. Shruthi. K.S", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "E1", room: "206", faculty: "Smt. Shruthi. K.S", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "F1", room: "207", faculty: "Smt. Shruthi. K.S", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "F2", room: "208", faculty: "Smt. Shruthi. K.S", capacity: 60, currentEnrollment: 0, type: "Theory" },
                    ]
                }
            ],
            phy: [
                {
                    code: "PHY1001",
                    name: "Physics of Optoelectronic devices",
                    credits: 4,
                    options: [
                        { slot: "D1", room: "207", faculty: "Dr. V.V. Jaiswal", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "E1", room: "207", faculty: "Dr. Lokesha HS", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "E1", room: "208", faculty: "Dr. Nagabhushana K R", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "F1", room: "208", faculty: "Dr. Lokesha HS", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        { slot: "G1", room: "207", faculty: "Dr. A. Balaksrishna", capacity: 60, currentEnrollment: 0, type: "Theory" },
                        // Lab slots - now 1 credit each
                        { slot: "L13+L14", room: "002", faculty: "Dr. A. Balaksrishna", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L15+L16", room: "002", faculty: "Dr. Nagabhushana K R", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L19+L20", room: "002", faculty: "Dr. V.V. Jaiswal", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L23+L24", room: "002", faculty: "Dr. Lokesha HS", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L27+L28", room: "002", faculty: "Dr. V.V. Jaiswal", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L29+L30", room: "002", faculty: "Dr. Nagabhushana K R", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L3+L4", room: "002", faculty: "Dr. Lokesha HS", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L31+L32", room: "002", faculty: "Dr. Lokesha HS", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L35+L36", room: "002", faculty: "Dr. A. Balaksrishna", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L7+L8", room: "002", faculty: "Dr. Lokesha HS", capacity: 60, currentEnrollment: 0, type: "Lab", credits: 1 },
                    ]
                }
            ],
            lang: [
                {
                    code: "FRE1001",
                    name: "Basic French",
                    credits: 2,
                    options: [
                        { slot: "L11+L12", room: "629", faculty: "Ms. Yamini Vij", capacity: 50, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L21+L22", room: "207", faculty: "Ms. Yamini Vij", capacity: 50, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L35+L36", room: "614", faculty: "Ms. Yamini Vij", capacity: 50, currentEnrollment: 0, type: "Lab", credits: 1 },
                    ]
                },
                {
                    code: "GER1001",
                    name: "Basic German",
                    credits: 2,
                    options: [
                        { slot: "L15+L16", room: "211", faculty: "Ms. Rukmini Vasanth", capacity: 50, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L29+L30", room: "206", faculty: "Ms. Rukmini Vasanth", capacity: 50, currentEnrollment: 0, type: "Lab", credits: 1 },
                    ]
                },
                {
                    code: "KAN1004",
                    name: "Kannada Literature",
                    credits: 2,
                    options: [
                        { slot: "A2", room: "210", faculty: "Dr.Ashokbabu", capacity: 50, currentEnrollment: 0, type: "Theory" },
                        { slot: "B1", room: "206", faculty: "Dr.Ashokbabu", capacity: 50, currentEnrollment: 0, type: "Theory" },
                        { slot: "B2", room: "620", faculty: "Dr.Ashokbabu", capacity: 50, currentEnrollment: 0, type: "Theory" },
                    ]
                },
                {
                    code: "KAN1005",
                    name: "Kannada Kali",
                    credits: 1,
                    options: [
                        { slot: "L23+L24", room: "206", faculty: "Dr.Ashokbabu", capacity: 50, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L37+L38", room: "615", faculty: "Dr.Ashokbabu", capacity: 50, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L7+L8", room: "615", faculty: "Dr.Ashokbabu", capacity: 50, currentEnrollment: 0, type: "Lab", credits: 1 },
                    ]
                },
                {
                    code: "ENG1003",
                    name: "Professional English",
                    credits: 3,
                    options: [
                        { slot: "L11+L12", room: "614", faculty: "Dr. Madhavi G.M", capacity: 50, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L11+L12", room: "209", faculty: "Ms. Ramya M.Η", capacity: 50, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L11+L12", room: "615", faculty: "Mr.Abirlal Mukherjee", capacity: 50, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L13+L14", room: "208", faculty: "Mr.Abirlal Mukherjee", capacity: 50, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L15+L16", room: "210", faculty: "Dr. Madhavi G.M", capacity: 50, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L33+L34", room: "614", faculty: "Ms.Ramya M.Η", capacity: 50, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L35+L36", room: "210", faculty: "Mr.Abirlal Mukherjee", capacity: 50, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L37+L38", room: "620", faculty: "Mr.Abirlal Mukherjee", capacity: 50, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L7+L8", room: "210", faculty: "Ms.Ramya M.Η", capacity: 50, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L7+L8", room: "211", faculty: "Mr.Abirlal Mukherjee", capacity: 50, currentEnrollment: 0, type: "Lab", credits: 1 },
                    ]
                }
            ],
            nutrition: [
                {
                    code: "BIT1002",
                    name: "Basic Human Nutrition",
                    credits: 3,
                    options: [
                        { slot: "D1", room: "209", faculty: "Mr.MD.Umar", capacity: 50, currentEnrollment: 0, type: "Theory" },
                        { slot: "D2", room: "620", faculty: "Mr.MD.Umar", capacity: 50, currentEnrollment: 0, type: "Theory" },
                        { slot: "E1", room: "211", faculty: "Mr.MD.Umar", capacity: 50, currentEnrollment: 0, type: "Theory" },
                        { slot: "E2", room: "614", faculty: "Mr.MD.Umar", capacity: 50, currentEnrollment: 0, type: "Theory" },
                        { slot: "F1", room: "312", faculty: "Dr Amit Verma", capacity: 50, currentEnrollment: 0, type: "Theory" },
                        { slot: "F1", room: "211", faculty: "Dr. A Sanjeeva Kumar", capacity: 50, currentEnrollment: 0, type: "Theory" },
                        { slot: "F2", room: "211", faculty: "Mr.MD.Umar", capacity: 50, currentEnrollment: 0, type: "Theory" },
                        { slot: "G1", room: "620", faculty: "Dr Amit Verma", capacity: 50, currentEnrollment: 0, type: "Theory" },
                    ]
                }
            ],
            psyc: [
                {
                    code: "PSY1002",
                    name: "Dynamics of Human Behaviour",
                    credits: 3,
                    options: [
                        { slot: "L1+L2", room: "209", faculty: "Ms. Varshini S", capacity: 50, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L17+L18", room: "210", faculty: "Ms. Varshini S", capacity: 50, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L21+L22", room: "209", faculty: "Ms. Shweta Singh", capacity: 50, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L25+L26", room: "312", faculty: "Ms. Shweta Singh", capacity: 50, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L37+L38", room: "209", faculty: "Ms. Varshini S", capacity: 50, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L37+L38", room: "206", faculty: "Ms. Shweta Singh", capacity: 50, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L9+L10", room: "209", faculty: "Ms. Shweta Singh", capacity: 50, currentEnrollment: 0, type: "Lab", credits: 1 },
                    ]
                },
                {
                    code: "PSY1001",
                    name: "Understanding Self for Effectiveness",
                    credits: 3,
                    options: [
                        { slot: "L1+L2", room: "615", faculty: "Ms. Shweta Singh", capacity: 50, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L29+L30", room: "209", faculty: "Ms. Shweta Singh", capacity: 50, currentEnrollment: 0, type: "Lab", credits: 1 },
                        { slot: "L5+L6", room: "211", faculty: "Ms. Varshini S", capacity: 50, currentEnrollment: 0, type: "Lab", credits: 1 },
                    ]
                },
                {
                    code: "PSY3111",
                    name: "Social Psychology",
                    credits: 3,
                    options: [
                        { slot: "B2", room: "311", faculty: "Ms. Varshini", capacity: 50, currentEnrollment: 0, type: "Theory" },
                    ]
                }
            ]
        };
        const TIME_BLOCKS = {
            "T1A": { start: "09:00", end: "09:50" },
            "T1B": { start: "09:55", end: "10:45" },
            "L1":  { start: "09:00", end: "10:40" }, // Represents the first morning lab time block (colspan 2)
            "T2A": { start: "10:50", end: "11:40" },
            "T2B": { start: "11:45", "end": "12:35" },
            "L2":  { start: "10:50", end: "12:30" }, // Represents the second morning lab time block (colspan 2)
            "T3A": { start: "13:15", end: "14:05" },
            "T3B": { start: "14:10", end: "15:00" },
            "L3":  { start: "13:15", end: "14:55" }, // Represents the first afternoon lab time block (colspan 2)
            "T4A": { start: "15:05", end: "15:55" },
            "T4B": { start: "16:00", end: "16:50" },
            "L4":  { start: "15:05", end: "16:45" }  // Represents the second afternoon lab time block (colspan 2)
        };
        const slotToTimetableMapping = {
            // Theory Slots (single cells) - Mapped to T1A, T1B, T2A, T2B, T3A, T3B, T4A, T4B
            "A1": [{ day: "MON", timeBlock: "T1A" }, { day: "WED", timeBlock: "T1B" }, { day: "FRI", timeBlock: "T2A" }],
            "F1": [{ day: "MON", timeBlock: "T1B" }, { day: "WED", timeBlock: "T2A" }],
            "D1": [{ day: "MON", timeBlock: "T2A" }, { day: "THU", timeBlock: "T1A" }],
            "TC1": [{ day: "MON", timeBlock: "T2B" }],
            "A2": [{ day: "MON", timeBlock: "T3A" }, { day: "WED", timeBlock: "T3B" }, { day: "FRI", timeBlock: "T4A" }],
            "F2": [{ day: "MON", timeBlock: "T3B" }, { day: "WED", timeBlock: "T4A" }],
            "D2": [{ day: "MON", timeBlock: "T4A" }, { day: "THU", timeBlock: "T3A" }],
            "TC2": [{ day: "MON", timeBlock: "T4B" }],
            "B1": [{ day: "TUE", timeBlock: "T1A" }, { day: "WED", timeBlock: "T2B" }, { day: "THU", timeBlock: "T1B" }],
            "G1": [{ day: "TUE", timeBlock: "T1B" }, { day: "THU", timeBlock: "T2A" }],
            "E1": [{ day: "TUE", timeBlock: "T2A" }, { day: "FRI", timeBlock: "T1A" }],
            "TA1": [{ day: "TUE", timeBlock: "T2B" }],
            "B2": [{ day: "TUE", timeBlock: "T3A" }, { day: "WED", timeBlock: "T4B" }, { day: "THU", timeBlock: "T3B" }],
            "G2": [{ day: "TUE", timeBlock: "T3B" }, { day: "THU", timeBlock: "T4A" }],
            "E2": [{ day: "TUE", timeBlock: "T4A" }, { day: "FRI", timeBlock: "T3A" }],
            "TA2": [{ day: "TUE", timeBlock: "T4B" }],
            "C1": [{ day: "WED", timeBlock: "T1A" }, { day: "THU", timeBlock: "T2B" }, { day: "FRI", timeBlock: "T1B" }],
            "C2": [{ day: "WED", timeBlock: "T3A" }, { day: "THU", timeBlock: "T4B" }, { day: "FRI", timeBlock: "T3B" }],
            "TB1": [{ day: "FRI", timeBlock: "T2B" }],
            "TB2": [{ day: "FRI", timeBlock: "T4B" }],

            // Lab Slots (pairs L1+L2, L3+L4 etc.) mapped to the colspan-2 time blocks (L1, L2, L3, L4)
            // Morning Labs (L1-L20)
            "L1+L2": [{ day: "MON", timeBlock: "L1" }],
            "L3+L4": [{ day: "MON", timeBlock: "L2" }],
            "L5+L6": [{ day: "TUE", timeBlock: "L1" }],
            "L7+L8": [{ day: "TUE", timeBlock: "L2" }],
            "L9+L10": [{ day: "WED", timeBlock: "L1" }],
            "L11+L12": [{ day: "WED", timeBlock: "L2" }],
            "L13+L14": [{ day: "THU", timeBlock: "L1" }],
            "L15+L16": [{ day: "THU", timeBlock: "L2" }],
            "L17+L18": [{ day: "FRI", timeBlock: "L1" }],
            "L19+L20": [{ day: "FRI", timeBlock: "L2" }],

            // Afternoon Labs (L21-L40)
            "L21+L22": [{ day: "MON", timeBlock: "L3" }],
            "L23+L24": [{ day: "MON", timeBlock: "L4" }],
            "L25+L26": [{ day: "TUE", timeBlock: "L3" }],
            "L27+L28": [{ day: "TUE", timeBlock: "L4" }],
            "L29+L30": [{ day: "WED", timeBlock: "L3" }],
            "L31+L32": [{ day: "WED", timeBlock: "L4" }],
            "L33+L34": [{ day: "THU", timeBlock: "L3" }],
            "L35+L36": [{ day: "THU", timeBlock: "L4" }],
            "L37+L38": [{ day: "FRI", timeBlock: "L3" }],
            "L39+L40": [{ day: "FRI", timeBlock: "L4" }],

            // Complex composite slots - these are combinations of the above pairs
            // Example: L1+L2 (MON-L1) & L11+L12 (WED-L2)
            "L1+L2 & L11+L12": [
                { day: "MON", timeBlock: "L1" },
                { day: "WED", timeBlock: "L2" }
            ],
            // Example: L11+L12 (WED-L2) & L19+L20 (FRI-L2)
            "L11+L12 & L19+L20": [
                { day: "WED", timeBlock: "L2" },
                { day: "FRI", timeBlock: "L2" }
            ],
            // Example: L31+L32 (WED-L4) & L21+L22 (MON-L3)
            "L31+L32 & L21+L22": [
                { day: "WED", timeBlock: "L4" },
                { day: "MON", timeBlock: "L3" }
            ],
            // Example: L35+L36 (THU-L4) & L25+L26 (TUE-L3)
            "L35+L36 & L25+L26": [
                { day: "THU", timeBlock: "L4" },
                { day: "TUE", timeBlock: "L3" }
            ],
            // Example: L21+L22 (MON-L3) & L37+L38 (FRI-L3)
            "L21+L22 & L37+L38": [
                { day: "MON", timeBlock: "L3" },
                { day: "FRI", timeBlock: "L3" }
            ],
            // Example: L21+L22 (MON-L3) & L39+L40 (FRI-L4)
            "L21+L22 & L39+L40": [
                { day: "MON", timeBlock: "L3" },
                { day: "FRI", timeBlock: "L4" }
            ],
            // Example: L27+L28 (TUE-L4) & L37+L38 (FRI-L3)
            "L27+L28 & L37+L38": [
                { day: "TUE", timeBlock: "L4" },
                { day: "FRI", timeBlock: "L3" }
            ],
            // Example: L27+L28 & L39+L40 (TUE-L4 & FRI-L4)
            "L27+L28 & L39+L40": [
                { day: "TUE", timeBlock: "L4" },
                { day: "FRI", timeBlock: "L4" }
            ],
        };
        const conflictMapping = {
            // Theory slots conflict with other theory slots in the same 50-min block and the corresponding 100-min lab block
            "T1A": ["T1A", "T1B", "L1"], "T1B": ["T1A", "T1B", "L1"], "L1":  ["T1A", "T1B", "L1"],
            "T2A": ["T2A", "T2B", "L2"], "T2B": ["T2A", "T2B", "L2"], "L2":  ["T2A", "T2B", "L2"],
            "T3A": ["T3A", "T3B", "L3"], "T3B": ["T3A", "T3B", "L3"], "L3":  ["T3A", "T3B", "L3"],
            "T4A": ["T4A", "T4B", "L4"], "T4B": ["T4A", "T4B", "L4"], "L4":  ["T4A", "T4B", "L4"]
        };
        let registeredCourses = [];
        let currentDepartment = 'cse';
        let totalCredits = 0;
        const sidebarItems = document.querySelectorAll('.sidebar-item');
        const selectedDeptTitle = document.getElementById('selected-dept-title');
        const availableCoursesList = document.getElementById('available-courses-list');
        const selectDeptMessage = document.getElementById('select-dept-message');
        const registeredCoursesList = document.getElementById('registered-courses-list');
        const noRegisteredMessage = document.getElementById('no-registered-message');
        const liveTimetable = document.getElementById('live-timetable');
        const messageBox = document.getElementById('messageBox');
        const messageTitle = document.getElementById('messageTitle');
        const messageText = document.getElementById('messageText');
        const totalCreditsDisplay = document.getElementById('total-credits');
        function showMessageBox(title, text, isError = false) {
            messageTitle.textContent = title;
            messageText.textContent = text;
            messageTitle.style.color = isError ? 'var(--error-red)' : 'var(--success-green)';
            messageBox.classList.remove('hidden');
        }
        function hideMessageBox() {
            messageBox.classList.add('hidden');
        }
        function getCourseByCode(courseCode) {
            for (const dept in departmentCourses) {
                const foundCourse = departmentCourses[dept].find(c => c.code === courseCode);
                if (foundCourse) {
                    return foundCourse;
                }
            }
            return null;
        }
        function getCourseOptionByCodeAndSlot(courseCode, slot) {
            const course = getCourseByCode(courseCode);
            if (course && course.options) {
                return course.options.find(opt => opt.slot === slot);
            }
            return null;
        }
        function calculateTotalCredits() {
            let sum = 0;
            const uniqueRegisteredCourses = new Set();
            registeredCourses.forEach(regCourse => {
                const uniqueKey = `${regCourse.code}-${regCourse.slot}`; // Use original composite slot for uniqueness
                if (!uniqueRegisteredCourses.has(uniqueKey)) {
                    uniqueRegisteredCourses.add(uniqueKey);
                    const course = getCourseByCode(regCourse.code);
                    const option = getCourseOptionByCodeAndSlot(regCourse.code, regCourse.slot);
                    if (option && option.credits !== undefined) {
                        sum += option.credits; // Use credits from the option if available
                    } else if (course) {
                        sum += course.credits; // Fallback to course credits
                    }
                }
            });
            totalCredits = sum;
            totalCreditsDisplay.textContent = totalCredits;
            if (totalCredits < 16 || totalCredits > 27) {
                totalCreditsDisplay.classList.add('text-red-600');
            } else {
                totalCreditsDisplay.classList.remove('text-red-600');
            }
        }
        function updateTimetableDisplay() {
            console.log("updateTimetableDisplay called.");
            // Clear all highlighting and content before updating
            document.querySelectorAll('.timetable td').forEach(cell => {
                cell.classList.remove('highlighted', 'registered', 'frozen', 'conflict');
                if (!cell.classList.contains('day-header') && !cell.classList.contains('slot-type-header') && !cell.classList.contains('lunch-slot')) {
                    cell.innerHTML = '';
                }
            });

            // Re-render registered courses first
            registeredCourses.forEach(regCourseEntry => {
                const day = regCourseEntry.day;
                const timeBlockId = regCourseEntry.timeBlock; // e.g., L1, L2, L3, L4
                const courseName = getCourseByCode(regCourseEntry.code)?.name;
                const originalSlotName = regCourseEntry.slot; // e.g., L1+L2 & L11+L12

                const cell = document.getElementById(`${day.toLowerCase()}-${timeBlockId}`);
                if (cell) {
                    console.log(`Marking registered: Day: ${day}, TimeBlock: ${timeBlockId}, Course: ${regCourseEntry.code}, Original Slot: ${originalSlotName}`);
                    cell.classList.add('registered');
                    // Display original slot name and individual time block for clarity
                    cell.innerHTML = `<div class="cell-content"><span>${regCourseEntry.code}</span><span>${originalSlotName}</span><span>(${timeBlockId})</span></div>`;
                    
                    // Mark conflicting/frozen slots
                    const conflictingBlocks = conflictMapping[timeBlockId];
                    if (conflictingBlocks) {
                        conflictingBlocks.forEach(conflictBlock => {
                            const conflictCell = document.getElementById(`${day.toLowerCase()}-${conflictBlock}`);
                            if (conflictCell && !conflictCell.classList.contains('registered')) {
                                conflictCell.classList.add('frozen');
                            }
                        });
                    }
                }
            });

            // Collect all currently selected slots from dropdowns
            const activeSelections = [];
            document.querySelectorAll('.slot-select').forEach(select => {
                const selectedSlot = select.value;
                const courseCode = select.dataset.courseCode;
                if (selectedSlot) {
                    const optionDetails = getCourseOptionByCodeAndSlot(courseCode, selectedSlot);
                    if (optionDetails) {
                        const slotMappings = slotToTimetableMapping[selectedSlot];
                        if (slotMappings) {
                            activeSelections.push({
                                courseCode: courseCode,
                                selectedSlot: selectedSlot,
                                mappings: slotMappings,
                                optionDetails: optionDetails
                            });
                        }
                    }
                }
            });

            // Perform inter-selection conflict detection and mark cells
            for (let i = 0; i < activeSelections.length; i++) {
                const selection1 = activeSelections[i];
                for (const mapping1 of selection1.mappings) {
                    const day1 = mapping1.day;
                    const timeBlock1 = mapping1.timeBlock;
                    const conflictingBlocks1 = conflictMapping[timeBlock1];

                    for (let j = 0; j < activeSelections.length; j++) {
                        // Skip if it's the same selection, or if it's the same course and same slot (already handled by dropdown disabled state)
                        if (i === j) continue;

                        const selection2 = activeSelections[j];
                        for (const mapping2 of selection2.mappings) {
                            const day2 = mapping2.day;
                            const timeBlock2 = mapping2.timeBlock;

                            // Check for day overlap and time block conflict
                            if (day1 === day2 && conflictingBlocks1.includes(timeBlock2)) {
                                // Conflict detected between selected slots
                                const cell1 = document.getElementById(`${day1.toLowerCase()}-${timeBlock1}`);
                                const cell2 = document.getElementById(`${day2.toLowerCase()}-${timeBlock2}`);

                                if (cell1 && !cell1.classList.contains('registered')) {
                                    cell1.classList.add('conflict');
                                    cell1.innerHTML = `<div class="cell-content"><span>CONFLICT!</span><span>${selection1.courseCode}</span><span>(${selection1.selectedSlot})</span></div>`;
                                }
                                if (cell2 && !cell2.classList.contains('registered')) {
                                    cell2.classList.add('conflict');
                                    cell2.innerHTML = `<div class="cell-content"><span>CONFLICT!</span><span>${selection2.courseCode}</span><span>(${selection2.selectedSlot})</span></div>`;
                                }
                            }
                        }
                    }
                }
            }

            // Apply highlighting for currently selected (but not yet registered) slots
            // This pass will now respect any 'conflict' class already applied by the inter-selection check
            activeSelections.forEach(selection => {
                selection.mappings.forEach(mapping => {
                    const day = mapping.day;
                    const timeBlockId = mapping.timeBlock;
                    const cell = document.getElementById(`${day.toLowerCase()}-${timeBlockId}`);
                    
                    if (cell && !cell.classList.contains('registered') && !cell.classList.contains('conflict')) {
                        // Only highlight if not already marked as registered or conflict
                        cell.classList.add('highlighted');
                        cell.innerHTML = `<div class="cell-content"><span>${selection.courseCode}</span><span>${selection.selectedSlot}</span><span>(${timeBlockId})</span></div>`;
                    }
                });
            });
        }
        function displayAvailableCourses(dept) {
            currentDepartment = dept;
            selectedDeptTitle.textContent = dept.toUpperCase();
            availableCoursesList.innerHTML = '';
            selectDeptMessage.classList.add('hidden');
            const courses = departmentCourses[dept] || [];
            if (courses.length === 0) {
                const noCoursesMsg = document.createElement('p');
                noCoursesMsg.textContent = 'No courses available for this department.';
                noCoursesMsg.classList.add('text-gray-600', 'text-center', 'py-10', 'col-span-full');
                availableCoursesList.appendChild(noCoursesMsg);
                return;
            }
            courses.forEach(course => {
                const courseElement = document.createElement('div');
                courseElement.classList.add('course-box');
                let optionsHtml = '';
                const theoryOptions = course.options.filter(opt => opt.type === 'Theory');
                const labOptions = course.options.filter(opt => opt.type === 'Lab');
                if (theoryOptions.length > 0) {
                    optionsHtml += '<h4 class="text-base font-semibold text-gray-700 mt-4 mb-2">Theory Slots</h4>';
                    optionsHtml += `<select class="slot-select" data-course-code="${course.code}" data-slot-type="Theory">`;
                    optionsHtml += '<option value="">Select Theory Slot</option>';
                    theoryOptions.forEach(opt => {
                        const isRegistered = registeredCourses.some(regCourse => regCourse.code === course.code && regCourse.slot === opt.slot);
                        const isFull = opt.currentEnrollment >= opt.capacity;
                        const isDisabled = isRegistered || isFull;
                        optionsHtml += `
                            <option value="${opt.slot}" ${isDisabled ? 'disabled' : ''}>
                                Slot: ${opt.slot} | Room: ${opt.room} | Faculty: ${opt.faculty} | Enrolled: ${opt.currentEnrollment}/${opt.capacity} ${isFull ? '(Full)' : ''} ${isRegistered ? '(Registered)' : ''}
                            </option>
                        `;
                    });
                    optionsHtml += '</select>';
                }
                if (labOptions.length > 0) {
                    if (theoryOptions.length > 0) {
                        optionsHtml += '<hr class="my-4 border-t border-gray-200">';
                    }
                    optionsHtml += '<h4 class="text-base font-semibold text-gray-700 mt-4 mb-2">Lab Slots</h4>';
                    optionsHtml += `<select class="slot-select" data-course-code="${course.code}" data-slot-type="Lab">`;
                    optionsHtml += '<option value="">Select Lab Slot</option>';
                    labOptions.forEach(opt => {
                        const isRegistered = registeredCourses.some(regCourse => regCourse.code === course.code && regCourse.slot === opt.slot);
                        const isFull = opt.currentEnrollment >= opt.capacity;
                        const isDisabled = isRegistered || isFull;
                        optionsHtml += `
                            <option value="${opt.slot}" ${isDisabled ? 'disabled' : ''}>
                                Slot: ${opt.slot} | Room: ${opt.room} | Faculty: ${opt.faculty} | Enrolled: ${opt.currentEnrollment}/${opt.capacity} ${isFull ? '(Full)' : ''} ${isRegistered ? '(Registered)' : ''}
                            </option>
                        `;
                    });
                    optionsHtml += '</select>';
                }
                const allOptionsUnavailable = course.options.every(opt => {
                    const isRegisteredByUser = registeredCourses.some(regCourse => regCourse.code === course.code && regCourse.slot === opt.slot);
                    const isFull = opt.currentEnrollment >= opt.capacity;
                    return isRegisteredByUser || isFull;
                });
                courseElement.innerHTML = `
                    <h3 class="font-montserrat">${course.code}: ${course.name}</h3>
                    <p>Credits: ${course.credits}</p>
                    ${optionsHtml}
                    <button class="${allOptionsUnavailable ? 'bg-gray-300 text-gray-500 cursor-not-allowed' : 'register-btn'}" data-course-code="${course.code}" ${allOptionsUnavailable ? 'disabled' : ''}>Register Selected Slot</button>
                `;
                availableCoursesList.appendChild(courseElement);
            });
            document.querySelectorAll('.slot-select').forEach(select => {
                select.addEventListener('change', updateTimetableDisplay);
            });
            document.querySelectorAll('.register-btn').forEach(button => {
                button.addEventListener('click', handleRegisterCourse);
            });
            updateTimetableDisplay();
            calculateTotalCredits();
        }
        function displayRegisteredCourses() {
            registeredCoursesList.innerHTML = '';
            if (registeredCourses.length === 0) {
                noRegisteredMessage.classList.remove('hidden');
            } else {
                noRegisteredMessage.classList.add('hidden');
                const uniqueRegisteredCourses = new Set();
                registeredCourses.forEach(regCourse => {
                    const uniqueId = `${regCourse.code}-${regCourse.slot}`;
                    if (!uniqueRegisteredCourses.has(uniqueId)) {
                        uniqueRegisteredCourses.add(uniqueId);
                        const course = getCourseByCode(regCourse.code);
                        const option = getCourseOptionByCodeAndSlot(regCourse.code, regCourse.slot);
                        if (course && option) {
                            const registeredItem = document.createElement('div');
                            registeredItem.classList.add('registered-course-item', 'flex', 'justify-between', 'items-center', 'space-x-4');
                            registeredItem.innerHTML = `
                                <div>
                                    <h3 class="font-montserrat text-lg">${course.code}: ${course.name}</h3>
                                    <p class="text-sm">Slot: ${option.slot} | Room: ${option.room} | Faculty: ${option.faculty}</p>
                                    <p class="text-sm">Type: ${option.type} | Credits: ${option.credits !== undefined ? option.credits : course.credits}</p>
                                </div>
                                <button class="deregister-btn px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50" data-course-code="${course.code}" data-slot="${option.slot}">Deregister</button>
                            `;
                            registeredCoursesList.appendChild(registeredItem);
                        }
                    }
                });
            }
        }
        function handleRegisterCourse(event) {
            const button = event.target;
            const courseCode = button.dataset.courseCode;
            const courseBox = button.closest('.course-box');
            
            const selectedSlots = Array.from(courseBox.querySelectorAll('.slot-select'))
                                     .filter(select => select.value !== '')
                                     .map(select => select.value);

            if (selectedSlots.length === 0) {
                showMessageBox('Registration Error', 'Please select at least one slot for the course before registering.', true);
                return;
            }

            let canRegister = true;
            let conflictInfo = { hasConflict: false, courseCode: '', slot: '' };
            let isFull = false;
            let creditsToAdd = 0;

            const slotsToProcess = [];

            for (const selectedSlot of selectedSlots) {
                const optionDetails = getCourseOptionByCodeAndSlot(courseCode, selectedSlot);
                if (!optionDetails) {
                    showMessageBox('Error', `Selected slot ${selectedSlot} not found for ${courseCode}.`, true);
                    canRegister = false;
                    break;
                }

                if (optionDetails.currentEnrollment >= optionDetails.capacity) {
                    isFull = true;
                    canRegister = false;
                    conflictInfo = { hasConflict: true, courseCode: courseCode, slot: selectedSlot };
                    break;
                }

                const slotMappings = slotToTimetableMapping[selectedSlot];
                if (!slotMappings) {
                    showMessageBox('Error', `Invalid timetable mapping for slot: ${selectedSlot}.`, true);
                    canRegister = false;
                    break;
                }
                
                // Add credits for this selected option
                creditsToAdd += (optionDetails.credits !== undefined ? optionDetails.credits : getCourseByCode(courseCode)?.credits || 0);

                slotsToProcess.push({
                    selectedSlot: selectedSlot, // Keep original selected slot
                    mappings: slotMappings,
                    type: optionDetails.type // Store type for consistency
                });
            }

            if (!canRegister) {
                 if (isFull) {
                    showMessageBox('Registration Failed', `Slot ${conflictInfo.slot} for ${conflictInfo.courseCode} is full. Please choose another slot.`, true);
                } else {
                    showMessageBox('Registration Failed', conflictInfo.slot ? `Selected slot conflicts with already registered course ${conflictInfo.courseCode} in slot ${conflictInfo.slot}.` : `A selected slot conflicts with an existing registration.`, true);
                }
                return;
            }

            // Perform a consolidated conflict check across all selected slots and existing registrations
            // This check now also considers conflicts with other *selected* (highlighted) slots
            const allSelectedSlotsForConflictCheck = [];
            document.querySelectorAll('.slot-select').forEach(select => {
                if (select.value) {
                    allSelectedSlotsForConflictCheck.push({
                        courseCode: select.dataset.courseCode,
                        selectedSlot: select.value,
                        mappings: slotToTimetableMapping[select.value]
                    });
                }
            });

            for (const item of slotsToProcess) {
                for (const mapping of item.mappings) {
                    const day = mapping.day;
                    const timeBlockId = mapping.timeBlock;
                    const conflictingBlocks = conflictMapping[timeBlockId];

                    // Check against already registered courses
                    const existingRegisteredConflict = registeredCourses.find(regCourse =>
                        regCourse.day === day && conflictingBlocks.includes(regCourse.timeBlock)
                    );
                    if (existingRegisteredConflict) {
                        canRegister = false;
                        conflictInfo = { hasConflict: true, courseCode: existingRegisteredConflict.code, slot: existingRegisteredConflict.slot };
                        break;
                    }

                    // Check against other *selected* (highlighted) courses
                    const existingSelectedConflict = allSelectedSlotsForConflictCheck.find(selItem => {
                        // Ensure it's not the current course/slot being processed
                        if (selItem.courseCode === item.courseCode && selItem.selectedSlot === item.selectedSlot) {
                            return false;
                        }
                        return selItem.mappings.some(selMapping =>
                            selMapping.day === day && conflictingBlocks.includes(selMapping.timeBlock)
                        );
                    });

                    if (existingSelectedConflict) {
                        canRegister = false;
                        conflictInfo = { hasConflict: true, courseCode: existingSelectedConflict.courseCode, slot: existingSelectedConflict.selectedSlot };
                        break;
                    }
                }
                if (!canRegister) break;
            }


            if (!canRegister) {
                if (isFull) {
                    showMessageBox('Registration Failed', `Slot ${conflictInfo.slot} for ${conflictInfo.courseCode} is full. Please choose another slot.`, true);
                } else {
                    showMessageBox('Registration Failed', `Selected slot conflicts with already registered course ${conflictInfo.courseCode} in slot ${conflictInfo.slot}. Please resolve conflicts before registering.`, true);
                }
                return;
            }

            const newTotalCredits = totalCredits + creditsToAdd;

            if (newTotalCredits < 16 || newTotalCredits > 27) {
                showMessageBox('Credit Limit Issue', `Registering this course would change your total credits to ${newTotalCredits}. Total credits must be between 16 and 27.`, true);
                return;
            }

            // If all checks pass, proceed with registration
            for (const item of slotsToProcess) {
                const selectedSlot = item.selectedSlot;
                const optionDetails = getCourseOptionByCodeAndSlot(courseCode, selectedSlot);
                if (optionDetails) {
                    optionDetails.currentEnrollment++; // Increment enrollment
                    item.mappings.forEach(mapping => {
                        registeredCourses.push({
                            code: courseCode,
                            slot: selectedSlot, // Store the original composite slot here
                            type: optionDetails.type,
                            day: mapping.day,
                            timeBlock: mapping.timeBlock
                        });
                    });
                }
            }
            saveRegisteredCourses();
            displayAvailableCourses(currentDepartment);
            displayRegisteredCourses();
            updateTimetableDisplay();
            calculateTotalCredits();
            showMessageBox('Success', `Course ${courseCode} registered successfully!`);
        }
        function handleDeregisterCourse(event) {
            const button = event.target;
            const courseCodeToDeregister = button.dataset.courseCode;
            const slotToDeregister = button.dataset.slot;

            const optionDetails = getCourseOptionByCodeAndSlot(courseCodeToDeregister, slotToDeregister);
            if (optionDetails) {
                optionDetails.currentEnrollment--;
            }

            // Filter out all entries related to this courseCode and slot
            registeredCourses = registeredCourses.filter(regCourse =>
                !(regCourse.code === courseCodeToDeregister && regCourse.slot === slotToDeregister)
            );
            
            saveRegisteredCourses();
            displayAvailableCourses(currentDepartment);
            displayRegisteredCourses();
            updateTimetableDisplay();
            calculateTotalCredits();
            showMessageBox('Deregistration', `Course ${courseCodeToDeregister} in slot ${slotToDeregister} deregistered.`);
        }
        function saveRegisteredCourses() {
            localStorage.setItem('registeredCourses', JSON.stringify(registeredCourses));

            const departmentCoursesCopy = JSON.parse(JSON.stringify(departmentCourses));
            for (const dept in departmentCoursesCopy) {
                departmentCoursesCopy[dept].forEach(course => {
                    course.options.forEach(option => {
                        const originalOption = getCourseOptionByCodeAndSlot(course.code, option.slot);
                        if (originalOption) {
                            option.currentEnrollment = originalOption.currentEnrollment;
                        }
                    });
                });
            }
            localStorage.setItem('departmentCourseData', JSON.stringify(departmentCoursesCopy));
        }
        function loadRegisteredCourses() {
            const storedRegistered = localStorage.getItem('registeredCourses');
            if (storedRegistered) {
                registeredCourses = JSON.parse(storedRegistered);
            }

            const storedCourseData = localStorage.getItem('departmentCourseData');
            if (storedCourseData) {
                const loadedData = JSON.parse(storedCourseData);
                for (const dept in loadedData) {
                    loadedData[dept].forEach(loadedCourse => {
                        const originalCourse = departmentCourses[dept]?.find(c => c.code === loadedCourse.code);
                        if (originalCourse) {
                            loadedCourse.options.forEach(loadedOption => {
                                const originalOption = originalCourse.options.find(opt => opt.slot === loadedOption.slot);
                                if (originalOption) {
                                    originalOption.currentEnrollment = loadedOption.currentEnrollment;
                                }
                            });
                        }
                    });
                }
            }
        }
        sidebarItems.forEach(item => {
            item.addEventListener('click', () => {
                sidebarItems.forEach(si => si.classList.remove('active'));
                item.classList.add('active');
                const dept = item.dataset.dept;
                displayAvailableCourses(dept);
            });
        });
        document.addEventListener('DOMContentLoaded', () => {
            loadRegisteredCourses();
            displayAvailableCourses(currentDepartment);
            displayRegisteredCourses();
            updateTimetableDisplay();
            calculateTotalCredits();
            document.getElementById('registered-courses-list').addEventListener('click', (event) => {
                if (event.target.classList.contains('deregister-btn')) {
                    handleDeregisterCourse(event);
                }
            });
        });
    </script>
</body>
</html>
